<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - TaskFlow</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #28bc1d;
            --primary-dark: #226844;
            --secondary-color: #69b72d;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #0dcaf0;
            --success-color: #198754;
            --bg-light: #f8f9fa;
            --text-dark: #212529;
            --sidebar-width: 280px;
        }

        body {
            font-family: 'Spline Sans', sans-serif;
            background-color: var(--bg-light);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            overflow-y: auto;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            font-size: 1.5rem;
            margin: 0;
            font-weight: 700;
        }

        .sidebar.collapsed .sidebar-header h3 {
            display: none;
        }

        .sidebar.collapsed .sidebar-header .logo-icon {
            margin: 0 auto;
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 0;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover, .nav-link.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-left-color: var(--primary-color);
        }

        .nav-link i, .nav-link .material-symbols-outlined {
            margin-right: 1rem;
            font-size: 1.2rem;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .nav-link {
            justify-content: center;
            padding: 0.75rem;
        }

        .sidebar.collapsed .nav-link span {
            display: none;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 70px;
        }

        .topbar {
            background: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toggle-sidebar {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-dark);
            cursor: pointer;
        }

        .content {
            padding: 2rem;
        }

        /* Stats Cards */
        .stats-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
            transition: transform 0.2s;
        }

        .stats-card:hover {
            transform: translateY(-2px);
        }

        .stats-card.high {
            border-left-color: var(--danger-color);
        }

        .stats-card.medium {
            border-left-color: var(--warning-color);
        }

        .stats-card.low {
            border-left-color: var(--success-color);
        }

        .stats-card.completed {
            border-left-color: var(--success-color);
        }

        .stats-card.pending {
            border-left-color: var(--warning-color);
        }

        .stats-card.overdue {
            border-left-color: var(--danger-color);
        }

        .stats-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stats-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin: 0;
        }

        /* Tables */
        .table-responsive {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .table thead th {
            background: var(--bg-light);
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
        }

        /* Priority Badges */
        .badge-priority-high {
            background-color: var(--danger-color);
        }

        .badge-priority-medium {
            background-color: var(--warning-color);
        }

        .badge-priority-low {
            background-color: var(--success-color);
        }

        /* Status Badges */
        .badge-status-completed {
            background-color: var(--success-color);
        }

        .badge-status-pending {
            background-color: var(--warning-color);
        }

        /* Buttons */
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: white;
        }

        /* Modals */
        .modal-header {
            background: var(--bg-light);
            border-bottom: 1px solid #dee2e6;
        }

        .modal-title {
            font-weight: 600;
        }

        /* Charts Placeholder */
        .chart-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 0;
                z-index: 1050;
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar.show {
                width: var(--sidebar-width);
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
        }

        /* Custom scrollbar */
        .sidebar::-webkit-scrollbar {
            width: 5px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        /* Priority colors */
        .priority-high { color: var(--danger-color); }
        .priority-medium { color: var(--warning-color); }
        .priority-low { color: var(--success-color); }

        /* Status colors */
        .status-completed { color: var(--success-color); }
        .status-pending { color: var(--warning-color); }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-crown me-2"></i>Admin Panel</h3>
        </div>
        <ul class="sidebar-nav">
            <li class="nav-item">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="tasks">
                    <i class="fas fa-tasks"></i>
                    <span>Task Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="reports">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports & Analytics</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="topbar">
            <button class="toggle-sidebar" id="toggleSidebar">
                <i class="fas fa-bars"></i>
            </button>
            <div class="d-flex align-items-center">
                <h4 class="mb-0 me-3" id="pageTitle">Dashboard Overview</h4>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle me-2"></i>Admin
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" id="profileBtn"><i class="fas fa-user me-2"></i>Profile</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" id="logoutBtn2"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard Section -->
            <div id="dashboardSection" class="section active">
                <div class="row mb-4">
                    <div class="col-12">
                        <h3><i class="fas fa-chart-line me-2"></i>Analytics Overview</h3>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-4" id="statsCards">
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="totalUsers">-</div>
                                    <p class="stats-label">Total Users</p>
                                </div>
                                <i class="fas fa-users text-primary" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="totalTasks">-</div>
                                    <p class="stats-label">Total Tasks</p>
                                </div>
                                <i class="fas fa-tasks text-success" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card completed">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="completedTasks">-</div>
                                    <p class="stats-label">Completed Tasks</p>
                                </div>
                                <i class="fas fa-check-circle text-success" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card pending">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="pendingTasks">-</div>
                                    <p class="stats-label">Pending Tasks</p>
                                </div>
                                <i class="fas fa-clock text-warning" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card overdue">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="overdueTasks">-</div>
                                    <p class="stats-label">Overdue Tasks</p>
                                </div>
                                <i class="fas fa-exclamation-triangle text-danger" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-3 col-md-4 col-sm-6 mb-3">
                        <div class="stats-card">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="stats-number" id="completionRate">-</div>
                                    <p class="stats-label">Completion Rate</p>
                                </div>
                                <i class="fas fa-percentage text-info" style="font-size: 2rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-history me-2"></i>Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <div class="loading" id="recentActivityLoading">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="visually-hidden">Loading...</span>
                                    </div>
                                </div>
                                <div class="table-responsive" id="recentActivityTable" style="display: none;">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Task</th>
                                                <th>User</th>
                                                <th>Status</th>
                                                <th>Created</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentActivityBody">
                                            <!-- Recent activity will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-chart-pie me-2"></i>Task Distribution</h5>
                            </div>
                            <div class="card-body">
                                <div id="taskDistributionChart" style="height: 250px;">
                                    <canvas id="priorityChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Task Management Section -->
            <div id="tasksSection" class="section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-tasks me-2"></i>Task Management</h3>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createTaskModal">
                        <i class="fas fa-plus me-2"></i>Create Task
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h5 class="mb-0">All Tasks</h5>
                            </div>
                            <div class="col-md-6">
                                <div class="d-flex gap-2 justify-content-end">
                                    <select class="form-select form-select-sm" style="width: auto;" id="taskFilter">
                                        <option value="all">All Tasks</option>
                                        <option value="pending">Pending</option>
                                        <option value="completed">Completed</option>
                                        <option value="overdue">Overdue</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="loading" id="tasksLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div class="table-responsive" id="tasksTable" style="display: none;">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Title</th>
                                        <th>User</th>
                                        <th>Priority</th>
                                        <th>Status</th>
                                        <th>Due Date</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="tasksBody">
                                    <!-- Tasks will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Management Section -->
            <div id="usersSection" class="section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-users me-2"></i>User Management</h3>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createUserModal">
                        <i class="fas fa-user-plus me-2"></i>Add User
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5>All Users</h5>
                    </div>
                    <div class="card-body">
                        <div class="loading" id="usersLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div class="table-responsive" id="usersTable" style="display: none;">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Total Tasks</th>
                                        <th>Completed</th>
                                        <th>Pending</th>
                                        <th>Joined</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersBody">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Section -->
            <div id="reportsSection" class="section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h3><i class="fas fa-chart-bar me-2"></i>Reports & Analytics</h3>
                    <select class="form-select" style="width: auto;" id="reportPeriod">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly" selected>Monthly</option>
                    </select>
                </div>

                <div class="row mb-4">
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Task Status Distribution</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="statusChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5>Priority Distribution</h5>
                            </div>
                            <div class="card-body">
                                <canvas id="priorityChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5>Top Active Users</h5>
                    </div>
                    <div class="card-body">
                        <div class="loading" id="reportsLoading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <div class="table-responsive" id="userActivityTable" style="display: none;">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Email</th>
                                        <th>Total Tasks</th>
                                        <th>Completion Rate</th>
                                        <th>Activity Level</th>
                                    </tr>
                                </thead>
                                <tbody id="userActivityBody">
                                    <!-- User activity will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div id="settingsSection" class="section">
                <h3><i class="fas fa-cog me-2"></i>Settings</h3>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>System Settings</h5>
                            </div>
                            <div class="card-body">
                                <p>System configuration options will be available here.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h5>Account Settings</h5>
                            </div>
                            <div class="card-body">
                                <p>Admin account management options will be available here.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div class="modal fade" id="createTaskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create New Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createTaskForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="taskTitle" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="taskTitle" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="taskUser" class="form-label">Assign to User *</label>
                                <select class="form-select" id="taskUser" required>
                                    <option value="">Select User</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="taskDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="taskDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="taskPriority" class="form-label">Priority</label>
                                <select class="form-select" id="taskPriority">
                                    <option value="low">Low</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="taskCategory" class="form-label">Category</label>
                                <select class="form-select" id="taskCategory">
                                    <option value="work">Work</option>
                                    <option value="personal" selected>Personal</option>
                                    <option value="study">Study</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="taskDueDate" class="form-label">Due Date</label>
                                <input type="datetime-local" class="form-control" id="taskDueDate">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="createTaskBtn">Create Task</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div class="modal fade" id="editTaskModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Task</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editTaskForm">
                        <input type="hidden" id="editTaskId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="editTaskTitle" class="form-label">Title *</label>
                                <input type="text" class="form-control" id="editTaskTitle" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="editTaskUser" class="form-label">Assign to User *</label>
                                <select class="form-select" id="editTaskUser" required>
                                    <option value="">Select User</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="editTaskDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="editTaskPriority" class="form-label">Priority</label>
                                <select class="form-select" id="editTaskPriority">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editTaskCategory" class="form-label">Category</label>
                                <select class="form-select" id="editTaskCategory">
                                    <option value="work">Work</option>
                                    <option value="personal">Personal</option>
                                    <option value="study">Study</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="editTaskStatus" class="form-label">Status</label>
                                <select class="form-select" id="editTaskStatus">
                                    <option value="pending">Pending</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editTaskDueDate" class="form-label">Due Date</label>
                            <input type="datetime-local" class="form-control" id="editTaskDueDate">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="updateTaskBtn">Update Task</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Delete</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="deleteMessage">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global variables
        let currentSection = 'dashboard';
        let usersData = [];
        let tasksData = [];
        let reportsData = {};

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkAdminAuth();
            setupEventListeners();
        });

        // Check admin authentication
        async function checkAdminAuth() {
            try {
                const response = await fetch('api/check_admin_auth.php');
                const data = await response.json();

                if (!data.authenticated || data.user_type !== 'admin') {
                    window.location.href = 'index.html';
                    return;
                }

                // Load initial data
                loadDashboardData();
                loadUsersData();
                loadTasksData();
                loadReportsData();
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = 'index.html';
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar navigation
            document.querySelectorAll('.nav-link[data-section]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.getAttribute('data-section');
                    switchSection(section);
                });
            });

            // Sidebar toggle
            document.getElementById('toggleSidebar').addEventListener('click', toggleSidebar);

            // Logout buttons
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('logoutBtn2').addEventListener('click', logout);

            // Task management
            document.getElementById('createTaskBtn').addEventListener('click', createTask);
            document.getElementById('updateTaskBtn').addEventListener('click', updateTask);
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDelete);

            // Filters
            document.getElementById('taskFilter').addEventListener('change', filterTasks);
            document.getElementById('reportPeriod').addEventListener('change', loadReportsData);
        }

        // Switch sections
        function switchSection(section) {
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector(`[data-section="${section}"]`).classList.add('active');

            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));

            // Show selected section
            document.getElementById(`${section}Section`).classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard Overview',
                tasks: 'Task Management',
                users: 'User Management',
                reports: 'Reports & Analytics',
                settings: 'Settings'
            };
            document.getElementById('pageTitle').textContent = titles[section] || 'Admin Panel';

            currentSection = section;
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');

            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                fetch('api/logout.php')
                    .then(() => {
                        window.location.href = 'index.html';
                    })
                    .catch(error => {
                        console.error('Logout error:', error);
                        window.location.href = 'index.html';
                    });
            }
        }

        // Load dashboard data
        async function loadDashboardData() {
            try {
                const response = await fetch('api/admin_get_reports.php?period=daily');
                const data = await response.json();

                if (data.success) {
                    // Update statistics
                    document.getElementById('totalUsers').textContent = data.statistics.total_users;
                    document.getElementById('totalTasks').textContent = data.statistics.total_tasks;
                    document.getElementById('completedTasks').textContent = data.statistics.completed_tasks;
                    document.getElementById('pendingTasks').textContent = data.statistics.pending_tasks;
                    document.getElementById('overdueTasks').textContent = data.statistics.overdue_tasks;

                    // Calculate completion rate
                    const completionRate = data.statistics.total_tasks > 0
                        ? Math.round((data.statistics.completed_tasks / data.statistics.total_tasks) * 100)
                        : 0;
                    document.getElementById('completionRate').textContent = completionRate + '%';

                    // Load recent activity
                    loadRecentActivity(data.recent_activity);
                }
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }

        // Load recent activity
        function loadRecentActivity(activities) {
            const tbody = document.getElementById('recentActivityBody');
            tbody.innerHTML = '';

            if (activities && activities.length > 0) {
                activities.slice(0, 10).forEach(activity => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${activity.title}</td>
                        <td>${activity.user_name}</td>
                        <td><span class="badge bg-${activity.status === 'completed' ? 'success' : 'warning'}">${activity.status}</span></td>
                        <td>${new Date(activity.created_at).toLocaleDateString()}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">No recent activity</td></tr>';
            }

            document.getElementById('recentActivityLoading').style.display = 'none';
            document.getElementById('recentActivityTable').style.display = 'block';
        }

        // Load users data
        async function loadUsersData() {
            try {
                const response = await fetch('api/get_all_users.php');
                const data = await response.json();

                if (data.success) {
                    usersData = data.users;
                    renderUsersTable();
                    populateUserSelects();
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        // Render users table
        function renderUsersTable() {
            const tbody = document.getElementById('usersBody');
            tbody.innerHTML = '';

            usersData.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.full_name || 'N/A'}</td>
                    <td>${user.email}</td>
                    <td>${user.task_count}</td>
                    <td><span class="badge bg-success">${user.completed_count}</span></td>
                    <td><span class="badge bg-warning">${user.pending_count}</span></td>
                    <td>${new Date(user.created_at).toLocaleDateString()}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('usersLoading').style.display = 'none';
            document.getElementById('usersTable').style.display = 'block';
        }

        // Load tasks data
        async function loadTasksData() {
            try {
                const response = await fetch('api/get_all_tasks_admin.php');
                const data = await response.json();

                if (data.success) {
                    tasksData = data.tasks;
                    renderTasksTable();
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        // Render tasks table
        function renderTasksTable(tasks = tasksData) {
            const tbody = document.getElementById('tasksBody');
            tbody.innerHTML = '';

            tasks.forEach(task => {
                const isOverdue = task.due_date && new Date(task.due_date) < new Date() && task.status !== 'completed';
                const row = document.createElement('tr');
                row.className = isOverdue ? 'table-danger' : '';

                row.innerHTML = `
                    <td>${task.id}</td>
                    <td>${task.title}</td>
                    <td>${task.user_name} (${task.user_email})</td>
                    <td><span class="badge bg-${getPriorityColor(task.priority)}">${task.priority}</span></td>
                    <td><span class="badge bg-${task.status === 'completed' ? 'success' : 'warning'}">${task.status}</span></td>
                    <td>${task.due_date ? new Date(task.due_date).toLocaleString() : 'N/A'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editTask(${task.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteTask(${task.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('tasksLoading').style.display = 'none';
            document.getElementById('tasksTable').style.display = 'block';
        }

        // Filter tasks
        function filterTasks() {
            const filter = document.getElementById('taskFilter').value;
            let filteredTasks = tasksData;

            if (filter === 'overdue') {
                filteredTasks = tasksData.filter(task =>
                    task.due_date &&
                    new Date(task.due_date) < new Date() &&
                    task.status !== 'completed'
                );
            } else if (filter !== 'all') {
                filteredTasks = tasksData.filter(task => task.status === filter);
            }

            renderTasksTable(filteredTasks);
        }

        // Load reports data
        async function loadReportsData() {
            const period = document.getElementById('reportPeriod').value;

            try {
                const response = await fetch(`api/admin_get_reports.php?period=${period}`);
                const data = await response.json();

                if (data.success) {
                    reportsData = data;

                    // Update charts
                    updateCharts(data);

                    // Update user activity table
                    renderUserActivityTable(data.user_activity);
                }
            } catch (error) {
                console.error('Error loading reports:', error);
            }
        }

        // Update charts
        function updateCharts(data) {
            // Status chart
            const statusCtx = document.getElementById('statusChart').getContext('2d');
            new Chart(statusCtx, {
                type: 'pie',
                data: {
                    labels: data.tasks_by_status.map(item => item.status),
                    datasets: [{
                        data: data.tasks_by_status.map(item => item.count),
                        backgroundColor: ['#ffc107', '#28a745']
                    }]
                }
            });

            // Priority chart
            const priorityCtx = document.getElementById('priorityChart').getContext('2d');
            new Chart(priorityCtx, {
                type: 'doughnut',
                data: {
                    labels: data.tasks_by_priority.map(item => item.priority),
                    datasets: [{
                        data: data.tasks_by_priority.map(item => item.count),
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                }
            });
        }

        // Render user activity table
        function renderUserActivityTable(users) {
            const tbody = document.getElementById('userActivityBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const completionRate = user.task_count > 0 ? Math.round((user.completed_count / user.task_count) * 100) : 0;
                const activityLevel = user.task_count > 10 ? 'High' : user.task_count > 5 ? 'Medium' : 'Low';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.full_name}</td>
                    <td>${user.email}</td>
                    <td>${user.task_count}</td>
                    <td>${completionRate}%</td>
                    <td><span class="badge bg-${activityLevel === 'High' ? 'success' : activityLevel === 'Medium' ? 'warning' : 'secondary'}">${activityLevel}</span></td>
                `;
                tbody.appendChild(row);
            });

            document.getElementById('reportsLoading').style.display = 'none';
            document.getElementById('userActivityTable').style.display = 'block';
        }

        // Populate user selects
        function populateUserSelects() {
            const selects = ['taskUser', 'editTaskUser'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Select User</option>';
                usersData.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.id;
                    option.textContent = `${user.full_name} (${user.email})`;
                    select.appendChild(option);
                });
            });
        }

        // Create task
        async function createTask() {
            const formData = {
                user_id: document.getElementById('taskUser').value,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                priority: document.getElementById('taskPriority').value,
                category: document.getElementById('taskCategory').value,
                due_date: document.getElementById('taskDueDate').value
            };

            if (!formData.user_id || !formData.title) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const response = await fetch('api/admin_create_task.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('createTaskModal')).hide();
                    document.getElementById('createTaskForm').reset();
                    loadTasksData();
                    loadDashboardData();
                    alert('Task created successfully!');
                } else {
                    alert(data.message || 'Failed to create task');
                }
            } catch (error) {
                console.error('Error creating task:', error);
                alert('Error creating task');
            }
        }

        // Edit task
        function editTask(taskId) {
            const task = tasksData.find(t => t.id == taskId);
            if (!task) return;

            document.getElementById('editTaskId').value = task.id;
            document.getElementById('editTaskTitle').value = task.title;
            document.getElementById('editTaskUser').value = task.user_id;
            document.getElementById('editTaskDescription').value = task.description || '';
            document.getElementById('editTaskPriority').value = task.priority;
            document.getElementById('editTaskCategory').value = task.category;
            document.getElementById('editTaskStatus').value = task.status;

            if (task.due_date) {
                const dueDate = new Date(task.due_date);
                document.getElementById('editTaskDueDate').value = dueDate.toISOString().slice(0, 16);
            }

            new bootstrap.Modal(document.getElementById('editTaskModal')).show();
        }

        // Update task
        async function updateTask() {
            const formData = {
                task_id: document.getElementById('editTaskId').value,
                title: document.getElementById('editTaskTitle').value,
                user_id: document.getElementById('editTaskUser').value,
                description: document.getElementById('editTaskDescription').value,
                priority: document.getElementById('editTaskPriority').value,
                category: document.getElementById('editTaskCategory').value,
                status: document.getElementById('editTaskStatus').value,
                due_date: document.getElementById('editTaskDueDate').value
            };

            try {
                const response = await fetch('api/admin_update_task.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('editTaskModal')).hide();
                    loadTasksData();
                    loadDashboardData();
                    alert('Task updated successfully!');
                } else {
                    alert(data.message || 'Failed to update task');
                }
            } catch (error) {
                console.error('Error updating task:', error);
                alert('Error updating task');
            }
        }

        // Delete task
        function deleteTask(taskId) {
            document.getElementById('deleteMessage').textContent = 'Are you sure you want to delete this task?';
            document.getElementById('confirmDeleteBtn').setAttribute('data-type', 'task');
            document.getElementById('confirmDeleteBtn').setAttribute('data-id', taskId);
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // Delete user
        function deleteUser(userId) {
            document.getElementById('deleteMessage').textContent = 'Are you sure you want to delete this user? All their tasks will also be deleted.';
            document.getElementById('confirmDeleteBtn').setAttribute('data-type', 'user');
            document.getElementById('confirmDeleteBtn').setAttribute('data-id', userId);
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // Confirm delete
        async function confirmDelete() {
            const type = this.getAttribute('data-type');
            const id = this.getAttribute('data-id');

            try {
                let endpoint = '';
                let formData = {};

                if (type === 'task') {
                    endpoint = 'admin_delete_task.php';
                    formData = { task_id: id };
                } else if (type === 'user') {
                    endpoint = 'admin_delete_user.php';
                    formData = { user_id: id };
                }

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                if (data.success) {
                    bootstrap.Modal.getInstance(document.getElementById('deleteModal')).hide();
                    if (type === 'task') {
                        loadTasksData();
                    } else {
                        loadUsersData();
                    }
                    loadDashboardData();
                    alert(`${type.charAt(0).toUpperCase() + type.slice(1)} deleted successfully!`);
                } else {
                    alert(data.message || `Failed to delete ${type}`);
                }
            } catch (error) {
                console.error(`Error deleting ${type}:`, error);
                alert(`Error deleting ${type}`);
            }
        }

        // Helper functions
        function getPriorityColor(priority) {
            switch (priority) {
                case 'high': return 'danger';
                case 'medium': return 'warning';
                case 'low': return 'success';
                default: return 'secondary';
            }
        }
    </script>
</body>
</html>
